# Throttle Aspect

## Use Case Summary

**Throttle Aspect** enables contracts to limit the frequency of invokation.

**Typical Senario**:
- In airdrop, limit the per address claim frequency.
- For hot projects, protect from DDoS.

## Team Members and Roles
Team Member 1: [ShiningRay - Core Dev]

## Problem Addressed

在很多场景中， 我们不希望某些特定的接口、方法被频繁调用， 因此提出了限流的概念。 例如， 在网页前端使用键入同时触发搜索的功能， 为了防止用户频繁触发搜索， 我们可以设置一个时间间隔， 在这个时间间隔内， 用户只能触发一次搜索。
同样在区块链中， 也有类似的场景： 例如， 在空投中， 我们不希望用户频繁领取空投， 因此， 我们可以设置一个时间间隔在这个时间间隔内， 用户只能领取一次空投。

The team aims to address the problem of limited flexibility and security in managing Ethereum accounts. When interacting with the wallet. EoAs often face limitations in terms of transaction signing and managing multiple accounts with various functions. The Throttle Aspect is designed to provide a solution to these challenges by allowing EoAs to create session keys for specific transactions, improving both security and usability.

For example, in high-frequency trading, each transaction requires interaction with the wallet, and each time, you need to click on the wallet to sign. However, with the Throttle, one-click trading becomes possible.


## Project Design

### Throttle Overview



#### 1. EoA binding session key to Aspect

![截屏2023-11-09 15.37.26.png](https://github.com/QiyuanMa/Throttle-aspect-example/blob/main/img/2023-11-09-15.37.26.png)



Additional info:

- `Specific contract` is a contract address. For example, if it’s a DEX contract address, it means that the session key is only limited to calling an Artex contract.

- `Specific methods` is a list of method signature of `Specific contract`. For example, if it’s `[0x0000CAFE, 0xCAFE0000,]` , it means that the session key is only limited to this two method.



#### 2. Use session key to sign transaction

![截屏2023-11-09 15.32.38.png](https://github.com/QiyuanMa/Throttle-aspect-example/blob/main/img/2023-11-09-15.32.38.png)

Additional info :

- The `from` is still the address of EoA.

- The signature `v,r,s` is generated by private key of sKey.



#### 3. Artela verify the transaction

![截屏2023-11-09 15.52.20.png](https://github.com/QiyuanMa/Throttle-aspect-example/blob/main/img/2023-11-09-15.52.20.png)

Additional info

- The transaction may be signed by the EoA privaten point needs to be verified by the EoA public key again if the Aspect returns key, so the joi false.



#### 4. Call contract

![截屏2023-11-09 15.54.18.png](https://github.com/ShiningRay/artela-throttle-aspect/blob/main/img/2023-11-09-15.54.18.png)

Additional info

- Smart contract doesn’t know which keys sign the tx.

- When the smart contract accesses `msg.sender` , the value is `from` in the transaction.



### Implementation
Session-key Aspect project contains three components:

- **Client**, `sessioin-key-aspect.js`, a client for the dApp front end to use session key.
- **Aspect**, wasm bytecode deployed on Artela
- **Explorer,** extend Artela explorer to show Aspect info

![截屏2023-11-09 16.16.17.png](https://github.com/ShiningRay/artela-throttle-aspect/blob/main/img/2023-11-09-16.16.17.png)


## Value to the Artela Ecosystem
The Throttle Aspect brings several valuable features to the Artela Ecosystem:

**Enhanced Security:** By limit the allowing EoAs to create session keys for specific transactions, the ecosystem becomes more secure as private keys are not exposed for every interaction.

**Improved Usability:** Users can enjoy a better user experience by managing one wallet with several extension functions, rather than dealing with multiple abstract accounts (AA).

**Flexibility:** EoAs can upgrade to a form of AA that supports session keys without the need to transfer assets, providing flexibility in managing accounts.

**Integration:** The Session-Key Aspect can be integrated into various dApps, enabling on-click trading for DeFi protocols, enhancing UX and wallet security for web applications, and making dApps function like web2 products with simplified login and interaction processes.

For more detailed information, please refer to the project repository.

## 与纯EVM实现的对比



## TODO & Future Plans

目前 Artela 的 FilterTx 切面尚未实装。 如果实装


## How to Use

### Project Intro

* Folder [aspect](https://github.com/ShiningRay/artela-throttle-aspect/blob/main/aspect/README.md) implements the session key Aspect;
* Folder [js_client](https://github.com/ShiningRay/artela-throttle-aspect/blob/main/js_client/session_key_aspect_client/README.md) implements the session key Aspect javascript client.

### Integration
* Bind session key Aspect to you contract by this [guide](https://github.com/ShiningRay/artela-throttle-aspect/blob/main/aspect/README.md)
* Integrate js client to you font-end dApp by this [guide](https://github.com/ShiningRay/artela-throttle-aspect/blob/main/js_client/session_key_aspect_client/README.md)
